<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Genre - GomoTV</title>
  <link rel="stylesheet" href="style.css" />
  <script src="shared-modal.js"></script>
  <style>
    /* Additional styles for collapsible genre menu */
    .genre-submenu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      padding-left: 15px;
    }
    
    .genre-submenu.active {
      max-height: 500px; /* Adjust based on content */
    }
    
    .genre-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    
    .genre-toggle::after {
      content: "‚ñº";
      font-size: 0.8rem;
      transition: transform 0.3s ease;
    }
    
    .genre-toggle.active::after {
      transform: rotate(180deg);
    }
    
    .genre-submenu a {
      display: block;
      padding: 8px 0;
      color: #ffffff;
      text-decoration: none;
      font-size: 0.9rem;
      transition: color 0.3s;
    }
    
    .genre-submenu a:hover {
      color: #e50914;
    }
    
    /* Light theme adjustments */
    body.light .genre-submenu a {
      color: #333333;
    }
    
    body.light .genre-submenu a:hover {
      color: #e50914;
    }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="menu-toggle" id="menu-toggle">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <h1 class="logo">GomoTV</h1>
    <button id="theme-toggle" class="theme-toggle">üåì</button>
  </header>

  <div class="menu-overlay" id="menu-overlay"></div>

  <nav class="hamburger-menu" id="hamburger-menu">
    <div class="menu-search-bar">
      <input type="text" id="menu-search-input" placeholder="Search movies or shows...">
      <button id="menu-search-button">üîç</button>
    </div>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li>
        <div class="genre-toggle" id="genre-toggle">Genre</div>
        <div class="genre-submenu" id="genre-submenu">
          <a href="genre.html?name=Action&id=28">Action</a>
          <a href="genre.html?name=Animation&id=16">Animation</a>
          <a href="genre.html?name=Comedy&id=35">Comedy</a>
          <a href="genre.html?name=Drama&id=18">Drama</a>
          <a href="genre.html?name=Fantasy&id=14">Fantasy</a>
          <a href="genre.html?name=Horror&id=27">Horror</a>
          <a href="genre.html?name=Romance&id=10749">Romance</a>
          <a href="genre.html?name=Sci-Fi&id=878">Sci-Fi</a>
          <a href="genre.html?name=Thriller&id=53">Thriller</a>
        </div>
      </li>
      <li><a href="country.html">Country</a></li>
      <li><a href="movies.html">Movies</a></li>
      <li><a href="tvshows.html">TV Shows</a></li>
      <li><a href="topimdb.html">Top IMDB</a></li>
    </ul>
  </nav>

  <main>
    <section style="padding: 20px;">
      <div class="genre-list">
        <h2 id="genre-title">üé≠ Select a Genre:</h2>
        <div class="genre-grid">
          <a href="genre.html?name=Action&id=28">Action</a>
          <a href="genre.html?name=Animation&id=16">Animation</a>
          <a href="genre.html?name=Comedy&id=35">Comedy</a>
          <a href="genre.html?name=Drama&id=18">Drama</a>
          <a href="genre.html?name=Fantasy&id=14">Fantasy</a>
          <a href="genre.html?name=Horror&id=27">Horror</a>
          <a href="genre.html?name=Romance&id=10749">Romance</a>
          <a href="genre.html?name=Sci-Fi&id=878">Sci-Fi</a>
          <a href="genre.html?name=Thriller&id=53">Thriller</a>
        </div>
      </div>
    </section>

    <div id="pagination-top" class="pagination"></div>
    <div class="search-results-grid" id="results-grid"></div>
    <div id="pagination" class="pagination"></div>
  </main>

  <div id="modal-container"></div>

  <script>
    // Configuration
    const API_KEY = '77312bdd4669c80af3d08e0bf719d7ff';
    const params = new URLSearchParams(location.search);
    const genreId = params.get('id');
    const genreName = params.get('name');
    let currentPage = parseInt(params.get('page')) || 1;

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      initThemeToggle();
      setupMenuToggle();
      setupMenuSearch();
      setupGenreToggle();
      
      if (genreId && genreName) {
        document.getElementById("genre-title").textContent = "üé≠ " + genreName;
        fetchGenreMovies(genreId, currentPage);
      }
    });

    // Genre toggle functionality
    function setupGenreToggle() {
      const genreToggle = document.getElementById('genre-toggle');
      const genreSubmenu = document.getElementById('genre-submenu');
      
      if (genreToggle && genreSubmenu) {
        genreToggle.addEventListener('click', function() {
          this.classList.toggle('active');
          genreSubmenu.classList.toggle('active');
        });
      }
    }

    // Menu toggle functionality
    function setupMenuToggle() {
      const menuBtn = document.getElementById('menu-toggle');
      const menu = document.getElementById('hamburger-menu');
      const overlay = document.getElementById('menu-overlay');
      
      if (menuBtn && menu && overlay) {
        menuBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          menuBtn.classList.toggle('active');
          menu.classList.toggle('active');
          overlay.classList.toggle('active');
          document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : '';
        });

        overlay.addEventListener('click', function() {
          menuBtn.classList.remove('active');
          menu.classList.remove('active');
          this.classList.remove('active');
          document.body.style.overflow = '';
        });

        // Close menu when clicking on any link
        document.querySelectorAll('#hamburger-menu a').forEach(link => {
          link.addEventListener('click', function() {
            menuBtn.classList.remove('active');
            menu.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
          });
        });
      }
    }

    // Menu search functionality
    function setupMenuSearch() {
      const menuSearchInput = document.getElementById('menu-search-input');
      const menuSearchButton = document.getElementById('menu-search-button');
      
      if (menuSearchButton && menuSearchInput) {
        menuSearchButton.addEventListener('click', performMenuSearch);
        menuSearchInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') performMenuSearch();
        });
      }
    }

    function performMenuSearch() {
      const searchTerm = document.getElementById('menu-search-input').value.trim();
      if (searchTerm.length >= 2) {
        // Close menu when searching
        document.getElementById('menu-toggle').classList.remove('active');
        document.getElementById('hamburger-menu').classList.remove('active');
        document.getElementById('menu-overlay').classList.remove('active');
        document.body.style.overflow = '';
        
        window.location.href = `search.html?q=${encodeURIComponent(searchTerm)}`;
      } else {
        alert('Please enter at least 2 characters');
      }
    }

    // Theme toggle functionality
    function initThemeToggle() {
      const toggleBtn = document.getElementById('theme-toggle');
      if (!toggleBtn) return;
      
      const currentTheme = localStorage.getItem('theme') || 'dark';
      document.body.classList.add(currentTheme);
      
      toggleBtn.addEventListener('click', function() {
        const isDark = document.body.classList.contains('dark');
        document.body.classList.toggle('dark', !isDark);
        document.body.classList.toggle('light', isDark);
        localStorage.setItem('theme', isDark ? 'light' : 'dark');
      });
    }

    // Fetch genre movies
    async function fetchGenreMovies(id, page = 1) {
      try {
        const res = await fetch(
          `https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&with_genres=${id}&page=${page}`
        );
        const data = await res.json();
        
        if (data.results && data.results.length > 0) {
          renderResults(data.results);
          renderPagination(data.total_pages);
        } else {
          showNoResults();
        }
      } catch (error) {
        console.error('Error fetching genre movies:', error);
        showErrorState();
      }
    }

    function renderResults(items) {
      const container = document.getElementById("results-grid");
      container.innerHTML = items.map(item => {
        const title = item.title;
        const year = item.release_date?.slice(0, 4) || '';
        const img = item.poster_path 
          ? `https://image.tmdb.org/t/p/w500${item.poster_path}`
          : 'https://via.placeholder.com/500x750?text=No+Poster';
        const rating = item.vote_average?.toFixed(1) || 'N/A';

        return `
          <div class="poster-wrapper">
            <img src="${img}" alt="${title}" data-id="${item.id}" data-type="movie">
            <div class="poster-label">${title}</div>
            <div class="poster-meta">
              <span>‚≠ê ${rating}</span>
              <span>${year}</span>
            </div>
          </div>
        `;
      }).join('');

      // Set up click events for the posters
      document.querySelectorAll('.poster-wrapper img').forEach(img => {
        img.addEventListener('click', () => {
          openModal(img.dataset.id, img.dataset.type);
        });
      });
    }

    function renderPagination(totalPages) {
      const pagTop = document.getElementById('pagination-top');
      const pagBottom = document.getElementById('pagination');
      
      if (totalPages <= 1) {
        pagTop.innerHTML = '';
        pagBottom.innerHTML = '';
        return;
      }

      let buttons = '';
      const minPage = Math.max(1, currentPage - 2);
      const maxPage = Math.min(totalPages, currentPage + 2);

      if (currentPage > 1) {
        buttons += `<button onclick="goToPage(${currentPage - 1})">¬´ Prev</button>`;
      }
      
      for (let i = minPage; i <= maxPage; i++) {
        buttons += `<button onclick="goToPage(${i})" ${i === currentPage ? 'class="active"' : ''}>${i}</button>`;
      }
      
      if (currentPage < totalPages) {
        buttons += `<button onclick="goToPage(${currentPage + 1})">Next ¬ª</button>`;
      }

      pagTop.innerHTML = buttons;
      pagBottom.innerHTML = buttons;
    }

    function goToPage(page) {
      window.location.href = `genre.html?name=${encodeURIComponent(genreName)}&id=${genreId}&page=${page}`;
    }

    function showNoResults() {
      document.getElementById('results-grid').innerHTML = `
        <p class="no-results">No movies found in this genre.</p>
      `;
    }

    function showErrorState() {
      document.getElementById('results-grid').innerHTML = `
        <p class="no-results">Failed to load movies. Please try again later.</p>
      `;
    }
  </script>
</body>
</html>
