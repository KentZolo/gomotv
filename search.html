<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>Search Results - GomoTV</title>
Â  <link rel="stylesheet" href="style.css" />
</head>
<body>
Â  <header class="navbar">
Â  Â  <button onclick="history.back()" class="menu-toggle">â†</button>
Â  Â  <h1 class="logo">Search Results</h1>
Â  </header>

Â  <main>
Â  Â  <h2 class="search-title" id="search-title">ğŸ” Results</h2>
Â  Â  <div class="search-results-grid" id="results-grid"></div>
Â  Â  <div id="pagination" class="pagination"></div>
Â  </main>

Â  <div id="modal-container"></div>

Â  <script>
Â  Â  const API_KEY = '77312bdd4669c80af3d08e0bf719d7ff';
Â  Â  const IMG_BASE = 'https://image.tmdb.org/t/p/w500';
Â  Â  const FALLBACK_IMAGE = 'https://via.placeholder.com/500x750?text=No+Poster';

Â  Â  const SERVERS = [
Â  Â  Â  { id: 'apimocine', name: 'Apimocine', url: (t, id) => `https://apimocine.vercel.app/${t}/${id}?autoplay=true` },
Â  Â  Â  { id: 'vidsrc', name: 'Vidsrc.to', url: (t, id) => `https://vidsrc.to/embed/${t}/${id}` },
Â  Â  Â  { id: 'vidsrccc', name: 'Vidsrc.cc', url: (t, id) => `https://vidsrc.cc/v2/embed/${t}/${id}` }
Â  Â  ];

Â  Â  const params = new URLSearchParams(location.search);
Â  Â  const query = params.get('q') || '';
Â  Â  let currentPage = parseInt(params.get('page')) || 1;

Â  Â  function getImageUrl(path) {
Â  Â  Â  return path ? IMG_BASE + path : FALLBACK_IMAGE;
Â  Â  }

Â  Â  async function searchMovies(query, page = 1) {
Â  Â  Â  const container = document.getElementById('results-grid');
Â  Â  Â  const title = document.getElementById('search-title');
Â  Â  Â  const pagination = document.getElementById('pagination');

Â  Â  Â  title.textContent = `ğŸ” Results for "${query}"`;

Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${API_KEY}&query=${encodeURIComponent(query)}&page=${page}`);
Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  const results = data.results.filter(item => item.media_type !== 'person');

Â  Â  Â  Â container.innerHTML = results.map(item => {
Â  const id = item.id;
Â  const type = item.media_type;
Â  const title = item.title || item.name;
Â  const year = item.release_date?.slice(0, 4) || item.first_air_date?.slice(0, 4) || '';
Â  const img = getImageUrl(item.poster_path || item.backdrop_path);

Â  return `
Â  Â  <div class="movie-card">
Â  Â  Â  <img class="movie-poster" src="${img}" alt="${title}" data-id="${id}" data-type="${type}" data-title="${title}">
Â  Â  Â  <div class="movie-info">
Â  Â  Â  Â  <h3>${title}</h3>
Â  Â  Â  Â  <p>${type === 'movie' ? 'ğŸ¬' : 'ğŸ“º'} ${year}</p>
Â  Â  Â  </div>
Â  Â  </div>
Â  `;
}).join('');

Â  Â  Â  Â  document.querySelectorAll('.movie-poster').forEach(img => {
Â  Â  Â  Â  Â  img.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  const id = img.dataset.id;
Â  Â  Â  Â  Â  Â  const type = img.dataset.type;
Â  Â  Â  Â  Â  Â  const title = img.dataset.title;
Â  Â  Â  Â  Â  Â  openModalPlayer(id, title, type);
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  renderPagination(data.total_pages);
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  container.innerHTML = '<p class="no-results">Something went wrong.</p>';
Â  Â  Â  Â  console.error(err);
Â  Â  Â  }
Â  Â  }

Â  Â  function renderPagination(totalPages) {
Â  Â  Â  const pagination = document.getElementById('pagination');
Â  Â  Â  if (totalPages <= 1) return pagination.innerHTML = '';

Â  Â  Â  let buttons = '';
Â  Â  Â  const maxPage = Math.min(currentPage + 2, totalPages);
Â  Â  Â  const minPage = Math.max(1, currentPage - 2);

Â  Â  Â  if (currentPage > 1) {
Â  Â  Â  Â  buttons += `<button onclick="goToPage(${currentPage - 1})">Â« Prev</button>`;
Â  Â  Â  }

Â  Â  Â  for (let i = minPage; i <= maxPage; i++) {
Â  Â  Â  Â  buttons += `<button onclick="goToPage(${i})" ${i === currentPage ? 'class="active"' : ''}>${i}</button>`;
Â  Â  Â  }

Â  Â  Â  if (currentPage < totalPages) {
Â  Â  Â  Â  buttons += `<button onclick="goToPage(${currentPage + 1})">Next Â»</button>`;
Â  Â  Â  }

Â  Â  Â  pagination.innerHTML = buttons;
Â  Â  }

Â  Â  function goToPage(page) {
Â  Â  Â  location.href = `search.html?q=${encodeURIComponent(query)}&page=${page}`;
Â  Â  }

Â  Â  function openModalPlayer(id, title, type) {
Â  Â  Â  const modal = document.createElement('div');
Â  Â  Â  modal.className = 'modal';
Â  Â  Â  document.body.style.overflow = 'hidden';

Â  Â  Â  modal.innerHTML = `
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  <span class="close-btn">Ã—</span>
Â  Â  Â  Â  Â  <h3>${title}</h3>
Â  Â  Â  Â  Â  <label>Server:</label>
Â  Â  Â  Â  Â  <select id="server-select"></select>
Â  Â  Â  Â  Â  <div class="iframe-shield">Loading player...</div>
Â  Â  Â  Â  Â  <iframe id="player-frame" allowfullscreen></iframe>
Â  Â  Â  Â  </div>
Â  Â  Â  `;

Â  Â  Â  document.getElementById('modal-container').appendChild(modal);
Â  Â  Â  const select = modal.querySelector('#server-select');

Â  Â  Â  SERVERS.forEach(server => {
Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  option.value = server.id;
Â  Â  Â  Â  option.textContent = server.name;
Â  Â  Â  Â  select.appendChild(option);
Â  Â  Â  });

Â  Â  Â  function loadServer(index) {
Â  Â  Â  Â  const server = SERVERS[index];
Â  Â  Â  Â  select.value = server.id;
Â  Â  Â  Â  const iframe = modal.querySelector('#player-frame');
Â  Â  Â  Â  iframe.src = server.url(type, id);

Â  Â  Â  Â  const shield = modal.querySelector('.iframe-shield');
Â  Â  Â  Â  shield.style.display = 'block';
Â  Â  Â  Â  setTimeout(() => shield.style.display = 'none', 3000);

Â  Â  Â  Â  iframe.onerror = () => {
Â  Â  Â  Â  Â  if (index + 1 < SERVERS.length) {
Â  Â  Â  Â  Â  Â  loadServer(index + 1);
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  shield.textContent = 'No working server found.';
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  }

Â  Â  Â  loadServer(0);

Â  Â  Â  select.addEventListener('change', () => {
Â  Â  Â  Â  const selected = SERVERS.find(s => s.id === select.value);
Â  Â  Â  Â  if (selected) {
Â  Â  Â  Â  Â  modal.querySelector('#player-frame').src = selected.url(type, id);
Â  Â  Â  Â  }
Â  Â  Â  });

Â  Â  Â  modal.querySelector('.close-btn').addEventListener('click', () => {
Â  Â  Â  Â  modal.remove();
Â  Â  Â  Â  document.body.style.overflow = '';
Â  Â  Â  });

Â  Â  Â  modal.addEventListener('click', (e) => {
Â  Â  Â  Â  if (e.target === modal) {
Â  Â  Â  Â  Â  modal.remove();
Â  Â  Â  Â  Â  document.body.style.overflow = '';
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  }

Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  if (query.length >= 2) {
Â  Â  Â  Â  searchMovies(query, currentPage);
Â  Â  Â  } else {
Â  Â  Â  Â  document.getElementById('results-grid').innerHTML = '<p class="no-results">Enter a valid search query.</p>';
Â  Â  Â  }
Â  Â  });
Â  </script>
</body>
</html>
